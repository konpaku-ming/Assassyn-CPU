# SRT4 é™¤æ³•å™¨æµ‹è¯•è¯´æ˜

## æ¦‚è¿°

`test_divider.py` æ˜¯ä¸º SRT-4 é™¤æ³•å™¨ (`src/divider.py`) ç¼–å†™çš„ç»¼åˆæµ‹è¯•ç¨‹åºã€‚

## æµ‹è¯•çº§åˆ«

### 1. å•å…ƒæµ‹è¯• (test_divider_basic)
å¿«é€ŸéªŒè¯é™¤æ³•å™¨ç±»çš„åŸºæœ¬ç»“æ„å’Œæ–¹æ³•ï¼Œä¸éœ€è¦è¿è¡Œå®Œæ•´çš„ä»¿çœŸã€‚

**æµ‹è¯•å†…å®¹ï¼š**
- æ£€æŸ¥æ‰€æœ‰å¿…éœ€æ–¹æ³•å­˜åœ¨
- éªŒè¯ 6 ä¸ª FSM çŠ¶æ€å®šä¹‰
- ç¡®è®¤ find_1.v å’Œ q_sel.v çš„å®ç°æ–¹æ³•å­˜åœ¨
- éªŒè¯æ‰€æœ‰å¯„å­˜å™¨æ­£ç¡®å®šä¹‰

### 2. é›†æˆæµ‹è¯• (test_divider)
ä½¿ç”¨å®Œæ•´ CPU æµæ°´çº¿è¿è¡Œ 37 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒéªŒè¯é™¤æ³•å™¨åœ¨å®é™…åœºæ™¯ä¸­çš„è¡Œä¸ºã€‚

**æµ‹è¯•ç”¨ä¾‹åˆ†ç±»ï¼š**
- **åŸºæœ¬é™¤æ³•** (DIV/DIVU): 10 ä¸ªæµ‹è¯•
- **å–æ¨¡è¿ç®—** (REM/REMU): 8 ä¸ªæµ‹è¯•  
- **ç‰¹æ®Šæƒ…å†µ**: 10 ä¸ªæµ‹è¯•
  - é™¤æ•°ä¸º 0 (4ä¸ª)
  - é™¤æ•°ä¸º 1 (4ä¸ª)
  - æœ‰ç¬¦å·æº¢å‡º (2ä¸ª)
- **è¾¹ç•Œæ¡ä»¶**: 9 ä¸ªæµ‹è¯•

## è¿è¡Œæµ‹è¯•

### å®Œæ•´æµ‹è¯•
```bash
cd /home/runner/work/Assassyn-CPU/Assassyn-CPU
python3 tests/test_divider.py
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
======================================================================
Starting RISC-V M Extension Division Tests...
======================================================================

======================================================================
Basic SRT4Divider Class Tests (Unit Tests)
======================================================================
Test 1: Initial state check
  âœ“ All required methods exist
Test 2: FSM states check
  âœ“ All 6 FSM states defined
Test 3: Key methods check
  âœ“ All key methods present (find_1, q_sel implementations)
Test 4: Register definitions check
  âœ“ All 14 required registers defined

======================================================================
âœ… All basic unit tests passed!
======================================================================

Starting full integration tests with CPU pipeline...
ğŸš€ Compiling system: test_divider...
...
âœ… All 37 division tests completed successfully!

======================================================================
ğŸ‰ All divider tests passed! âœ…
======================================================================
```

## æµ‹è¯•è¦†ç›–ç‡

### RISC-V M æ‰©å±•æŒ‡ä»¤
| æŒ‡ä»¤ | ç±»å‹ | æµ‹è¯•ç”¨ä¾‹æ•° |
|------|------|-----------|
| DIV  | æœ‰ç¬¦å·é™¤æ³• | 10+ |
| DIVU | æ— ç¬¦å·é™¤æ³• | 8+ |
| REM  | æœ‰ç¬¦å·å–æ¨¡ | 9+ |
| REMU | æ— ç¬¦å·å–æ¨¡ | 6+ |

### ç®—æ³•ç‰¹æ€§
- âœ“ SRT-4 è¿­ä»£è®¡ç®—è·¯å¾„
- âœ“ å‰å¯¼ 1 æ£€æµ‹ (find_1.v â†’ find_leading_one)
- âœ“ å•†é€‰æ‹©é€»è¾‘ (q_sel.v â†’ quotient_select)
- âœ“ Q/QM ç´¯åŠ å™¨é€»è¾‘
- âœ“ éƒ¨åˆ†ä½™æ•°æ›´æ–°
- âœ“ ç¬¦å·ä¿®æ­£

### ç‰¹æ®Šæƒ…å†µï¼ˆRISC-V è§„èŒƒç¬¦åˆæ€§ï¼‰
- âœ“ é™¤æ•°ä¸º 0 é”™è¯¯å€¼
- âœ“ æœ‰ç¬¦å·æº¢å‡º (-2Â³Â¹ / -1)
- âœ“ ä½™æ•°ç¬¦å·çº¦å®š
- âœ“ å‘é›¶èˆå…¥

## æµ‹è¯•å‘é‡ç¤ºä¾‹

```python
# åŸºæœ¬é™¤æ³•
("DIV: 10 / 3", ALUOp.DIV, 10, 3, 3)
("DIV: -10 / 3", ALUOp.DIV, 0xFFFFFFF6, 3, 0xFFFFFFFD)  # -10 / 3 = -3

# å–æ¨¡
("REM: 10 % 3", ALUOp.REM, 10, 3, 1)
("REM: -10 % 3", ALUOp.REM, 0xFFFFFFF6, 3, 0xFFFFFFFF)  # -10 % 3 = -1

# é™¤æ•°ä¸º 0
("DIV: x / 0 (error)", ALUOp.DIV, 42, 0, 0xFFFFFFFF)  # è¿”å› -1

# æœ‰ç¬¦å·æº¢å‡º
("DIV: -2^31 / -1 (overflow)", ALUOp.DIV, 0x80000000, 0xFFFFFFFF, 0x80000000)
```

## æ€§èƒ½è€ƒè™‘

- **æ¯ä¸ªæµ‹è¯•å‘¨æœŸ**: ~18 å‘¨æœŸï¼ˆSRT-4 é™¤æ³•å™¨ï¼‰
- **å‘¨æœŸé¢„ç®—**: æ¯ä¸ªæµ‹è¯•åˆ†é… 25 å‘¨æœŸä½™é‡
- **æ€»æµ‹è¯•æ—¶é—´**: 37 æµ‹è¯• Ã— 25 å‘¨æœŸ + 100 å‘¨æœŸä½™é‡ â‰ˆ 1025 å‘¨æœŸ

## ä¾èµ–å…³ç³»

```
test_divider.py
â”œâ”€â”€ assassyn.frontend         # Assassyn ç¡¬ä»¶æè¿°æ¡†æ¶
â”œâ”€â”€ src.divider               # SRT4Divider ç±»
â”œâ”€â”€ src.execution             # CPU æ‰§è¡Œé˜¶æ®µ
â”œâ”€â”€ src.control_signals       # ALUOp, æ§åˆ¶ä¿¡å·
â”œâ”€â”€ tests.common              # run_test_module è¾…åŠ©å‡½æ•°
â””â”€â”€ tests.test_mock           # Mock æ¨¡å— (SRAM, MEM, Feedback)
```

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šModuleNotFoundError: No module named 'assassyn'
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ Assassyn æ¡†æ¶å·²æ­£ç¡®å®‰è£…ã€‚æµ‹è¯•éœ€è¦åœ¨ Assassyn ç¯å¢ƒä¸­è¿è¡Œã€‚

### é—®é¢˜ï¼šæµ‹è¯•è¶…æ—¶
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥ `finish()` æ¡ä»¶ï¼Œç¡®ä¿ç»™äºˆè¶³å¤Ÿçš„å‘¨æœŸè®©é™¤æ³•å™¨å®Œæˆæ‰€æœ‰æ“ä½œã€‚

### é—®é¢˜ï¼šæµ‹è¯•å¤±è´¥ä½†çœ‹ä¸åˆ°å…·ä½“é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼šæŸ¥çœ‹å®Œæ•´çš„ä»¿çœŸè¾“å‡ºï¼Œæ£€æŸ¥ log() è¾“å‡ºä¸­çš„ "Expected" ä¸å®é™…ç»“æœçš„å¯¹æ¯”ã€‚

## æ‰©å±•æµ‹è¯•

å¦‚éœ€æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹ï¼Œä¿®æ”¹ `DividerDriver.build()` ä¸­çš„ `vectors` åˆ—è¡¨ï¼š

```python
vectors = [
    # æ·»åŠ æ–°çš„æµ‹è¯•å‘é‡
    ("Test name", ALUOp.DIV, dividend_value, divisor_value, expected_result),
    ...
]
```

## å‚è€ƒèµ„æ–™

- **RISC-V è§„èŒƒ**: "M" Standard Extension for Integer Multiplication and Division
- **SRT4.v**: `SRT4/SRT4.v` - Verilog å‚è€ƒå®ç°
- **divider.py**: `src/divider.py` - Python/Assassyn å®ç°
- **ä¹˜æ³•å™¨æµ‹è¯•**: `tests/test_mul_extension.py` - ç±»ä¼¼çš„æµ‹è¯•æ¨¡å¼

---

**ä½œè€…**: GitHub Copilot  
**æ—¥æœŸ**: 2024-12-27  
**ç‰ˆæœ¬**: 1.0
