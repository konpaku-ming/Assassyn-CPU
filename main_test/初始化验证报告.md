# Assassyn CPU å†…å­˜åˆå§‹åŒ–éªŒè¯æŠ¥å‘Š

## éªŒè¯æ—¥æœŸ
2025-12-13

## éªŒè¯ç›®çš„
éªŒè¯ `accumulate_data.bin` å’Œ `accumulate_text.bin` å·²æˆåŠŸè½¬æ¢ä¸º Assassyn SRAM åˆå§‹åŒ–æ ¼å¼ï¼Œå¹¶ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚

## 1. æºæ–‡ä»¶éªŒè¯

### è¾“å…¥æ–‡ä»¶æ£€æŸ¥
```bash
$ ls -lh main_test/accumulate_*.bin
-rw-rw-r-- 1 runner runner  0 Dec 13 06:39 accumulate_data.bin
-rw-rw-r-- 1 runner runner 88 Dec 13 06:39 accumulate_text.bin
```

**åˆ†æ**:
- âœ… `accumulate_data.bin`: 0å­—èŠ‚ï¼ˆæ­£å¸¸ï¼Œç¨‹åºä¸éœ€è¦é™æ€æ•°æ®ï¼‰
- âœ… `accumulate_text.bin`: 88å­—èŠ‚ = 22æ¡æŒ‡ä»¤ Ã— 4å­—èŠ‚/æŒ‡ä»¤

## 2. è½¬æ¢è¿‡ç¨‹éªŒè¯

### è¿è¡Œè½¬æ¢è„šæœ¬
```bash
$ cd main_test
$ python3 convert_bin_to_exe.py
```

### è½¬æ¢è¾“å‡º
```
======================================================================
Assassyn CPU Memory Initialization Converter
======================================================================

ğŸ“ Workspace directory: /home/runner/work/Assassyn-CPU/Assassyn-CPU/.workspace

âœ… Converted Data Memory (accumulate_data.bin â†’ workload_mem.exe):
   Input:  accumulate_data.bin (0 bytes, 0 words)
   Output: .workspace/workload_mem.exe

âœ… Converted Instruction Memory (accumulate_text.bin â†’ workload_ins.exe):
   Input:  accumulate_text.bin (88 bytes, 22 words)
   Output: .workspace/workload_ins.exe
   First few values: 0xfe010113 0x00812e23 0x02010413 0xfe042423 

âœ… Created initialization file: .workspace/workload.init

======================================================================
âœ… Conversion completed successfully!
======================================================================
```

**ç»“æœ**: âœ… è½¬æ¢æˆåŠŸ

## 3. è¾“å‡ºæ–‡ä»¶éªŒè¯

### ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
```bash
$ ls -lh .workspace/
total 8.0K
-rw-rw-r-- 1 runner runner   9 Dec 13 06:40 workload.init
-rw-rw-r-- 1 runner runner 198 Dec 13 06:40 workload_ins.exe
-rw-rw-r-- 1 runner runner   0 Dec 13 06:40 workload_mem.exe
```

### æ–‡ä»¶è¡Œæ•°ç»Ÿè®¡
```bash
$ wc -l .workspace/*.exe .workspace/*.init
  22 .workspace/workload_ins.exe
   0 .workspace/workload_mem.exe
   1 .workspace/workload.init
  23 total
```

**éªŒè¯ç»“æœ**:
- âœ… `workload_ins.exe`: 22è¡Œï¼ˆ22æ¡æŒ‡ä»¤ï¼‰
- âœ… `workload_mem.exe`: 0è¡Œï¼ˆæ— æ•°æ®ï¼‰
- âœ… `workload.init`: 1è¡Œï¼ˆåç§»é‡åˆå§‹åŒ–ï¼‰

## 4. æŒ‡ä»¤å†…å®¹éªŒè¯

### å®Œæ•´æŒ‡ä»¤åˆ—è¡¨

| åœ°å€ (å­—èŠ‚) | åœ°å€ (å­—) | æŒ‡ä»¤ç¼–ç  | åæ±‡ç¼–æŒ‡ä»¤ | åŠŸèƒ½è¯´æ˜ |
|------------|----------|----------|------------|----------|
| 0x00 | 0 | fe010113 | addi sp, sp, -32 | åˆ†é…32å­—èŠ‚æ ˆç©ºé—´ |
| 0x04 | 1 | 00812e23 | sw s0, 28(sp) | ä¿å­˜å¸§æŒ‡é’ˆ s0 |
| 0x08 | 2 | 02010413 | addi s0, sp, 32 | è®¾ç½®æ–°å¸§æŒ‡é’ˆ |
| 0x0C | 3 | fe042423 | sw zero, -24(s0) | sum = 0 |
| 0x10 | 4 | 00100793 | addi a5, zero, 1 | i = 1 |
| 0x14 | 5 | fef42623 | sw a5, -20(s0) | å­˜å‚¨ i |
| 0x18 | 6 | 0200006f | jal zero, 32 | è·³è½¬åˆ°åœ°å€ 0x38 |
| 0x1C | 7 | fe842703 | lw a4, -24(s0) | åŠ è½½ sum |
| 0x20 | 8 | fec42783 | lw a5, -20(s0) | åŠ è½½ i |
| 0x24 | 9 | 00f707b3 | add a5, a4, a5 | sum = sum + i |
| 0x28 | 10 | fef42423 | sw a5, -24(s0) | å­˜å‚¨ sum |
| 0x2C | 11 | fec42783 | lw a5, -20(s0) | åŠ è½½ i |
| 0x30 | 12 | 00178793 | addi a5, a5, 1 | i = i + 1 |
| 0x34 | 13 | fef42623 | sw a5, -20(s0) | å­˜å‚¨ i |
| 0x38 | 14 | fec42703 | lw a4, -20(s0) | åŠ è½½ i |
| 0x3C | 15 | 06400793 | addi a5, zero, 100 | è®¾ç½®å¾ªç¯ä¸Šé™ 100 |
| 0x40 | 16 | fce7dee3 | bge a5, a4, -36 | å¦‚æœ i <= 100ï¼Œè·³å› 0x1C |
| 0x44 | 17 | 00000793 | addi a5, zero, 0 | è¿”å›å€¼ = 0 |
| 0x48 | 18 | 00078513 | addi a0, a5, 0 | è®¾ç½®è¿”å›å¯„å­˜å™¨ a0 |
| 0x4C | 19 | 01c12403 | lw s0, 28(sp) | æ¢å¤å¸§æŒ‡é’ˆ s0 |
| 0x50 | 20 | 02010113 | addi sp, sp, 32 | æ¢å¤æ ˆæŒ‡é’ˆ |
| 0x54 | 21 | 00008067 | jalr zero, 0(ra) | è¿”å› |

### æŒ‡ä»¤ç»Ÿè®¡

- **æ€»æŒ‡ä»¤æ•°**: 22æ¡
- **æŒ‡ä»¤ç±»å‹åˆ†å¸ƒ**:
  - ADDI: 9æ¡ (ç®—æœ¯ç«‹å³æ•°)
  - SW: 4æ¡ (å­˜å‚¨å­—)
  - LW: 4æ¡ (åŠ è½½å­—)
  - ADD: 1æ¡ (åŠ æ³•)
  - JAL: 1æ¡ (è·³è½¬é“¾æ¥)
  - BGE: 1æ¡ (å¤§äºç­‰äºåˆ†æ”¯)
  - JALR: 1æ¡ (å¯„å­˜å™¨è·³è½¬)

- **åŠŸèƒ½æ¨¡å—**:
  1. æ ˆå¸§è®¾ç½®: 3æ¡æŒ‡ä»¤ (0-2)
  2. å˜é‡åˆå§‹åŒ–: 3æ¡æŒ‡ä»¤ (3-5)
  3. è·³è½¬åˆ°å¾ªç¯æ£€æŸ¥: 1æ¡æŒ‡ä»¤ (6)
  4. å¾ªç¯ä½“: 7æ¡æŒ‡ä»¤ (7-13)
  5. å¾ªç¯æ¡ä»¶æ£€æŸ¥: 3æ¡æŒ‡ä»¤ (14-16)
  6. å‡½æ•°è¿”å›: 5æ¡æŒ‡ä»¤ (17-21)

## 5. æ•°æ®å®Œæ•´æ€§éªŒè¯

### è¿è¡ŒéªŒè¯è„šæœ¬
```bash
$ python3 verify_conversion.py
```

### éªŒè¯è¾“å‡º
```
======================================================================
Assassyn CPU Memory Initialization - Verification
======================================================================

âœ… Data Memory (accumulate_data.bin â†’ workload_mem.exe): Verification passed! (0 words)

âœ… Instruction Memory (accumulate_text.bin â†’ workload_ins.exe): Verification passed! (22 words)
   First few values: 0xfe010113 0x00812e23 0x02010413 0xfe042423 

======================================================================
âœ… All verifications passed!

The memory initialization files are ready for CPU simulation.
You can now run: python src/main.py
======================================================================
```

**éªŒè¯ç»“æœ**: âœ… æ‰€æœ‰éªŒè¯é€šè¿‡

## 6. å­—èŠ‚åºéªŒè¯

### ç¤ºä¾‹ï¼šç¬¬ä¸€æ¡æŒ‡ä»¤çš„å­—èŠ‚åº

**æŒ‡ä»¤ç¼–ç **: 0xfe010113 (addi sp, sp, -32)

**åœ¨ accumulate_text.bin ä¸­çš„å­˜å‚¨** (å°ç«¯åº):
```
åç§»é‡: 00 01 02 03
å­—èŠ‚:   13 01 01 fe
```

**åœ¨ workload_ins.exe ä¸­çš„è¡¨ç¤º**:
```
fe010113
```

**éªŒè¯**: âœ… å­—èŠ‚åºæ­£ç¡®ï¼ˆå°ç«¯åºï¼‰

## 7. CPU åŠ è½½æœºåˆ¶éªŒè¯

### main.py ä¸­çš„åŠ è½½é…ç½®

```python
# åœ¨ src/main.py çš„ build_cpu() å‡½æ•°ä¸­ï¼š
workspace = f"{current_path}/../.workspace/"

# æ•°æ®å†…å­˜åˆå§‹åŒ–
main_memory = SRAM(
    width=32, 
    depth=1 << depth_log,  # depth_log=16 â†’ 65536 å­—
    init_file=f"{workspace}/workload_mem.exe"
)

# æŒ‡ä»¤ç¼“å­˜åˆå§‹åŒ–
icache = SRAM(
    width=32, 
    depth=1 << depth_log,
    init_file=f"{workspace}/workload_ins.exe"
)
```

**é…ç½®éªŒè¯**:
- âœ… init_file è·¯å¾„æ­£ç¡®æŒ‡å‘ `.workspace/workload_*.exe`
- âœ… æ•°æ®å®½åº¦: 32ä½
- âœ… å†…å­˜æ·±åº¦: 65536å­— (è¶³å¤Ÿå®¹çº³22æ¡æŒ‡ä»¤)
- âœ… æ–‡ä»¶æ ¼å¼: æ¯è¡Œä¸€ä¸ª32ä½åå…­è¿›åˆ¶æ•°

## 8. åŠŸèƒ½é¢„æœŸ

### Accumulate ç¨‹åºæ‰§è¡Œé¢„æœŸ

**ç¨‹åºåŠŸèƒ½**: è®¡ç®— 1+2+3+...+100

**é¢„æœŸç»“æœ**: 5050 (0x13BA)

**æ‰§è¡Œæµç¨‹**:
1. **åˆå§‹åŒ–é˜¶æ®µ** (æŒ‡ä»¤ 0-5):
   - è®¾ç½®æ ˆå¸§
   - sum = 0
   - i = 1

2. **å¾ªç¯é˜¶æ®µ** (æŒ‡ä»¤ 7-16, å¾ªç¯100æ¬¡):
   - åŠ è½½ sum å’Œ i
   - sum = sum + i
   - i = i + 1
   - å¦‚æœ i <= 100ï¼Œç»§ç»­å¾ªç¯

3. **è¿”å›é˜¶æ®µ** (æŒ‡ä»¤ 17-21):
   - è®¾ç½®è¿”å›å€¼ a0 = 0
   - æ¢å¤æ ˆå¸§
   - è¿”å›

**é¢„æœŸå¯„å­˜å™¨çŠ¶æ€** (ç¨‹åºç»“æŸæ—¶):
- `a0` (x10): 0 (è¿”å›å€¼)
- å†…å­˜ `[s0-24]`: 0x13BA (5050, sum çš„æœ€ç»ˆå€¼)
- å†…å­˜ `[s0-20]`: 0x65 (101, i çš„æœ€ç»ˆå€¼)

## 9. æµ‹è¯•å»ºè®®

### æ¨èæµ‹è¯•æ­¥éª¤

1. **åŸºç¡€æµ‹è¯•** - éªŒè¯æŒ‡ä»¤è·å–:
   ```bash
   pytest tests/test_fetch.py -v
   ```

2. **è§£ç æµ‹è¯•** - éªŒè¯æŒ‡ä»¤è§£ç :
   ```bash
   pytest tests/test_decoder.py -v
   ```

3. **æ‰§è¡Œæµ‹è¯•** - éªŒè¯æŒ‡ä»¤æ‰§è¡Œ:
   ```bash
   pytest tests/test_execute_part1.py -v
   pytest tests/test_execute_part2.py -v
   pytest tests/test_execute_part3.py -v
   ```

4. **å†…å­˜æµ‹è¯•** - éªŒè¯å†…å­˜è®¿é—®:
   ```bash
   pytest tests/test_memory.py -v
   ```

5. **å®Œæ•´ä»¿çœŸ** - è¿è¡Œå®Œæ•´ CPU:
   ```bash
   python src/main.py
   ```

### éªŒè¯ç‚¹

åœ¨ä»¿çœŸä¸­åº”æ£€æŸ¥ï¼š
- âœ… PC ä» 0x00 å¼€å§‹
- âœ… æŒ‡ä»¤æ­£ç¡®è¯»å–å¹¶è§£ç 
- âœ… æ ˆæ“ä½œæ­£ç¡®
- âœ… å¾ªç¯æ­£ç¡®æ‰§è¡Œ100æ¬¡
- âœ… æœ€ç»ˆ sum = 5050
- âœ… ç¨‹åºæ­£å¸¸è¿”å›

## 10. æ€»ç»“

### éªŒè¯ç»“æœæ±‡æ€»

| éªŒè¯é¡¹ | çŠ¶æ€ | è¯¦æƒ… |
|--------|------|------|
| æºæ–‡ä»¶å­˜åœ¨ | âœ… | accumulate_data.bin (0B), accumulate_text.bin (88B) |
| æ–‡ä»¶è½¬æ¢ | âœ… | æˆåŠŸç”Ÿæˆ .exe æ–‡ä»¶ |
| æŒ‡ä»¤æ•°é‡ | âœ… | 22æ¡æŒ‡ä»¤ |
| æ•°æ®å®Œæ•´æ€§ | âœ… | å­—èŠ‚å¯¹å­—èŠ‚éªŒè¯é€šè¿‡ |
| å­—èŠ‚åº | âœ… | å°ç«¯åºæ­£ç¡® |
| æ–‡ä»¶æ ¼å¼ | âœ… | ç¬¦åˆ Assassyn SRAM æ ¼å¼ |
| CPU é…ç½® | âœ… | main.py æ­£ç¡®é…ç½®åŠ è½½è·¯å¾„ |

### ç»“è®º

âœ… **å†…å­˜åˆå§‹åŒ–å·²æˆåŠŸå®Œæˆ**

æ‰€æœ‰éªŒè¯é¡¹å‡é€šè¿‡ï¼Œ`main_memory` å’Œ `icache` å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ CPU ä»¿çœŸæµ‹è¯•ã€‚

### ä¸‹ä¸€æ­¥

1. è¿è¡Œ CPU ä»¿çœŸ: `python src/main.py`
2. è¿è¡Œæµ‹è¯•å¥—ä»¶: `pytest tests/ -v`
3. éªŒè¯ accumulate ç¨‹åºæ‰§è¡Œç»“æœ
4. å¦‚éœ€æ›´æ¢æµ‹è¯•ç¨‹åºï¼Œé‡å¤è½¬æ¢æµç¨‹

---

**éªŒè¯äººå‘˜**: GitHub Copilot  
**éªŒè¯æ—¶é—´**: 2025-12-13  
**å·¥å…·ç‰ˆæœ¬**: Python 3.x, Assassyn HDL  
**éªŒè¯çŠ¶æ€**: âœ… é€šè¿‡
