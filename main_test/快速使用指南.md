# Assassyn CPU 内存初始化 - 快速使用指南

## 🚀 快速开始（5分钟）

### 1. 确认文件已准备好
```bash
cd Assassyn-CPU/main_test
ls accumulate_*.bin
```

应该看到：
- `accumulate_data.bin` - 数据段
- `accumulate_text.bin` - 指令段

### 2. 运行转换脚本
```bash
python3 convert_bin_to_exe.py
```

看到 ✅ 表示成功！

### 3. 验证转换结果
```bash
python3 verify_conversion.py
```

看到 ✅ All verifications passed! 即可。

### 3.5. 全面测试（推荐）
```bash
python3 test_initialization.py
```

这会运行完整的测试套件，验证：
- ✅ 目录结构
- ✅ 文件格式
- ✅ 指令内容
- ✅ CPU 配置

### 4. 运行 CPU
```bash
cd ..
python src/main.py
```

完成！CPU 会自动加载初始化文件。

---

## 📁 文件结构

```
Assassyn-CPU/
├── main_test/
│   ├── accumulate_data.bin          # 输入：数据段
│   ├── accumulate_text.bin          # 输入：指令段
│   ├── convert_bin_to_exe.py        # 工具：转换脚本
│   ├── verify_conversion.py         # 工具：验证脚本
│   ├── 初始化报告.md                 # 文档：详细报告
│   ├── 初始化验证报告.md             # 文档：验证报告
│   └── 快速使用指南.md               # 文档：本文档
│
├── .workspace/                       # 自动生成
│   ├── workload_mem.exe             # 输出：数据内存初始化
│   ├── workload_ins.exe             # 输出：指令内存初始化
│   └── workload.init                # 输出：偏移量初始化
│
└── src/
    └── main.py                      # CPU 构建脚本（自动加载）
```

---

## 🔄 工作流程图

```
accumulate_data.bin  ──┐
                       ├──> convert_bin_to_exe.py ──> .workspace/workload_mem.exe ──┐
accumulate_text.bin  ──┘                            > .workspace/workload_ins.exe ──┤
                                                    > .workspace/workload.init      │
                                                                                     │
                                                                                     ↓
                                                                              src/main.py
                                                                                     │
                                                                                     ↓
                                                                              CPU 仿真运行
```

---

## 📝 常用命令

### 查看生成的文件
```bash
ls -lh ../.workspace/
```

### 查看指令内容
```bash
cat ../.workspace/workload_ins.exe
```

### 查看指令数量
```bash
wc -l ../.workspace/workload_ins.exe
```

### 查看数据内容
```bash
cat ../.workspace/workload_mem.exe
```

---

## ⚙️ 使用自己的程序

### 方法 1: 替换二进制文件

```bash
# 1. 准备你的 .bin 文件
cp your_data.bin 0to100_data.bin
cp your_text.bin 0to100_text.bin

# 2. 运行转换
python3 convert_bin_to_exe.py

# 3. 运行 CPU
cd .. && python src/main.py
```

### 方法 2: 从 RISC-V 工具链生成

```bash
# 编译你的程序
riscv32-unknown-elf-gcc -march=rv32i -mabi=ilp32 -nostdlib -o program.elf program.c

# 提取二进制段
riscv32-unknown-elf-objcopy -O binary -j .text program.elf 0to100_text.bin
riscv32-unknown-elf-objcopy -O binary -j .data program.elf 0to100_data.bin

# 转换并运行
python3 convert_bin_to_exe.py
cd .. && python src/main.py
```

---

## ❓ 常见问题

### Q1: 转换脚本报错找不到文件
**A**: 确保在 `main_test/` 目录下运行，并且 `.bin` 文件存在。

```bash
cd main_test
ls *.bin
python3 convert_bin_to_exe.py
```

### Q2: .workspace 目录不存在
**A**: 转换脚本会自动创建，或手动创建：

```bash
mkdir -p .workspace
```

### Q3: 数据文件是空的正常吗？
**A**: 正常！accumulate 程序不需要静态数据，只使用栈。

### Q4: 如何查看指令内容？
**A**: 使用 cat 或 hexdump 查看：

```bash
cat ../.workspace/workload_ins.exe
```

### Q5: 修改了 .bin 文件后要做什么？
**A**: 重新运行转换脚本：

```bash
python3 convert_bin_to_exe.py
```

---

## 🧪 测试相关

### 运行全部测试
```bash
cd ..
pytest tests/ -v
```

### 运行特定测试
```bash
pytest tests/test_fetch.py -v       # 指令获取测试
pytest tests/test_decoder.py -v     # 指令解码测试
pytest tests/test_memory.py -v      # 内存访问测试
```

---

## 📊 Accumulate 程序信息

### 程序功能
计算 1+2+3+...+100 = **5050** (0x13BA)

### 程序规模
- **指令数**: 22条
- **文件大小**: 88字节
- **数据段**: 0字节（使用栈）

### 指令分布
- ADDI: 9条 (41%)
- SW: 4条 (18%)
- LW: 4条 (18%)
- ADD: 1条 (5%)
- JAL: 1条 (5%)
- BGE: 1条 (5%)
- JALR: 1条 (5%)

### 测试覆盖
- ✅ 算术运算
- ✅ 内存读写
- ✅ 循环控制
- ✅ 分支跳转
- ✅ 函数调用/返回

---

## 🔗 相关文档

- **详细说明**: `初始化报告.md` - 完整的技术文档
- **验证报告**: `初始化验证报告.md` - 详细的验证结果
- **快速指南**: `快速使用指南.md` - 本文档

---

## 📞 获取帮助

### 查看详细日志
转换和验证脚本都会输出详细信息，包括：
- 文件大小
- 指令数量
- 前几个值的预览
- 错误信息（如果有）

### 检查文件格式
生成的 `.exe` 文件格式应该是：
- 纯文本文件
- 每行一个8位十六进制数
- 小写字母
- 无 `0x` 前缀

示例：
```
fe010113
00812e23
02010413
```

---

**最后更新**: 2025-12-13  
**版本**: 1.0  
**状态**: ✅ 可用
